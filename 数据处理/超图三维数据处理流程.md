# 超图数据处理流程

>- 概述：主要阐述如何将独立坐标系下的`.FBX`格式数据，经过一系列数据处理，最终利用超图`IServer`发布为三维切片服务。
>- 目的：为以后进行类似的数据处理提供参考，以便节约时间成本。  
---
### 数据处理流程主要包括：
  1. **数据转换**，`.FBX`格式转超图`.UDB`（超图文件型数据源） 
  2. **数据配准**，主要将独立坐标系配准到84坐标系 
  3. **数据切片**，（超图叫缓存）
  4. **服务发布**
---
### 1. 数据转换
#### 前期准备
- 打开`超图`软件，新建一个空的数据源文件用于存放数据转换后的数据：`数据源`---`新建文件型数据源`---`.UDB`
- 将新建的数据源文件关闭，再进行数据转换。否则转换的数据后续无法成功导入！！！
> 利用`3ds Max`软件进行数据转换，`3ds Max`需要安装超图插件
#### 转换操作过程
1.  打开`3ds Max`，先将`3d Max`的单位设置为“米”，`自定义`---`单位设置`---`系统单位设置`
2. 导入`FBX`文件，检查导入设置的单位是否也为“米”，`高级`---`单位`
3. `超图Max插件`---`生成模型数据集`
   - `插入点信息`保持默认
   - `Max纹理信息`---`纹理路径`---选择 导入文件 对应的纹理文件
   - `文件生成信息`---把三个勾选框都去掉
   - `数据源文件路径`---选择前期新建的数据源文件`.UDB`
   - `可选数据集`---查看已有数据集；`新建数据集`---给新添加的数据集命名 
---

### 2. 数据配准
1. 打开`超图`---`打开已有的文件型数据源`---打开导出的`UDB`文件
2. `开始`---`配准`---`快速配准`---选择已有的配准信息文件(`.drfu`)
3. 三维模型除了做以上水平面的几何位置配准，还需要做垂直方向高度的调整，使之贴合真实地表。`三维地理设计`---`模型编辑`---`批量平移`---输入高度，正数升高，负数降低
> 超图中一般先新建一个球面场景，然后在球面场景中显示模型与影像。可通过`快速定位到该图层`迅速找到三维模型位置。
---
### 3. 数据切片
> 在超图中切片步骤称为生成缓存
1. 将生成的模型都添加在`场景`中---关闭`场景`---保存`场景`---右键`场景`---`生成场景缓存`
2. 弹窗选择：
   - 选择需要切片的缓存
   - 选择`缓存路径`(即切片存放的路径)
   - *选择文件类型为`S3M`*  
   - 其他默认即可
3. 生成的结果文件，每个模型对应一个切片文件夹
---
### 4. 服务发布 
> 只能在服务器电脑上发布
1. 启动`iserver` (`iserver`的`bin`目录下启动`startup.bat`)
2. 打开浏览器，输入`localhost:8090`
3. `服务管理`---`快速发布一个服务`
   1. `数据来源`：`工作空间`---`下一步`
   2. - `工作空间类型`：`文件型`
      - `工作空间路径`：`远程浏览`---选择切片缓存的工作空间
   3. `REST-三维服务`
4. 点击配置完成后的url链接，选择`realspace`---`scences`---`WebGL3D(支持浏览s3m和osgb缓存)`，即可查看发布的三维场景。
> 后续在iserver查看发布三维场景，可通过`服务管理`---`服务管理`---`三维服务`---找到相应的场景打开
   
    









